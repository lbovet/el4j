<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                             "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:el4j="http://www.elca.ch/el4j/taglib"
	template="layout/template.xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:c="http://java.sun.com/jstl/core">

	<ui:define name="body">

		<el4j:set var="entityClassName"
			value="ch.elca.el4j.seam.demo.entities.Employee" />


        <ui:include src="/WEB-INF/facelet/modalPanel.xhtml">
        
             <!-- Id for the popup -->
            <c:set var="panelId" value="mp" />
        
	        <!-- the text to display in the help popup -->
	        
	        <!-- Title  -->
	        <c:set var="panelTitle" value="Employees (half-generic)" />
	    
	    
	        <!--  user instructions -->
	        <c:set var="userText" value="On this page you can insert, search,
	        edit and delete employee entries." />
	        
	        <!-- technical explanation -->
	        <c:set var="technicalText" value="The purpose of this page is to
	        show how the generic EntityManager can be used. The search is
	        implemented as a filter on the 'lastName' property. Listing the
	        entries is showed once using a 'h:dataTable' and once using the
	        'ui:repeat' facelets tag. Have a look at the source code for
	        more details." />
	         
	    </ui:include>
	        
	     <div align="right">
                <table border="0">
                    <tr>
                        <td>
                              <h:graphicImage value="img/help.png" style="cursor:pointer" 
                              onclick="Richfaces.showModalPanel('mp',{width:450, top:200})" />
                       </td>
                       <td>
                               <a style="vertical-align: center;font-size:11px" href="javascript:Richfaces.showModalPanel('mp',{width:450, top:200})">
                               About this page...</a>
                       </td>        
                   </tr>
               </table>
         </div>   

		<h2>
			Search employees using EntityManager
		</h2>
		<h:form>
		    Last Name: 
			<h:inputText id="search" value="#{searchString}"></h:inputText>
			<h:commandButton value="Find" action="#{filters.add('lastName')}" />
			<s:button value="Clear" action="#{filters.removeAll()}" />
		</h:form>

		<h3>
			List of found employees (using generic EntityManager and h:dataTable):
		</h3>
		<h:form>
			<h:dataTable value="#{entityManager.getEntities()}" var="e">
				<h:column>
					<h:outputText value="#{e.visa}" />
				</h:column>
				<h:column>
					<h:outputText value="#{e.lastName}" />
				</h:column>
				<h:column>
					<h:commandLink value="edit"
						action="#{entityManager.edit(e, '/employeeEditGeneric.xhtml')}" />
				</h:column>
				<h:column>
					<h:commandLink value="delete" action="#{entityManager.delete(e)}" />
				</h:column>
			</h:dataTable>
		</h:form>

		<h3>
			List of found employees (using generic EntityManager and ui:repeat):
		</h3>
		<h:form>
			<ui:remove><!-- entities is the outjected list of all loaded entites.
				This is equal to entityManager.getEntities() --></ui:remove>
			<ui:repeat value="#{entities}" var="e">
				<div>
					#{e.lastName}
					<h:outputText value=" " />
					<h:commandLink value="edit"
						action="#{entityManager.edit(e, '/employeeEditGeneric.xhtml')}" />
					<h:outputText value=" " />
					<h:commandLink value="delete" action="#{entityManager.delete(e)}" />
				</div>
			</ui:repeat>
		</h:form>

		<h2>
			Insert employee:
		</h2>
		<h:form>
			<s:validateAll>
				<h:panelGrid columns="2">
					<ui:remove><!-- employee stands for a new instance of Employee --></ui:remove>
					Visa: <h:inputText value="#{employee.visa}" required="true" />
					First Name: <h:inputText value="#{employee.firstName}" required="true" />
					Last Name: <h:inputText value="#{employee.lastName}" required="true" />
				</h:panelGrid>
			</s:validateAll>
			<h:messages />
			<h:commandButton value="Add"
				action="#{entityManager.saveOrUpdate(employee)}" />
		</h:form>
	</ui:define>

</ui:composition>