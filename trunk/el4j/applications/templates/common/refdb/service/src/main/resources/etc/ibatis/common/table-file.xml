<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="refdb-core">
    <!-- Version: $Revision$ -->
    <!-- URL: $URL$ -->
    <!-- Date: $Date$ -->
    <!-- Author: $Author$ -->

    <!-- 
        File related invocations
    -->
    <typeAlias 
        type="com.ibatis.sqlmap.engine.type.BlobTypeHandlerCallback"
        alias="blobHandler" />
    
    <resultMap id="file" class="ch.elca.el4j.apps.refdb.dom.File">
        <result property="key" column="KEYID"/>
        <result property="keyToReference" column="KEYTOREFERENCE"/>
        <result property="name" column="NAME"/>
        <result property="mimeType" column="MIMETYPE"/>
        <result property="size" column="CONTENTSIZE"/>
        <result property="content" column="CONTENT" typeHandler="blobHandler"/>
        <result property="optimisticLockingVersion" 
            column="OPTIMISTICLOCKINGVERSION"/>
    </resultMap>

    <statement id="getFileByKey" parameterClass="int" resultMap="file">
        select KEYID, KEYTOREFERENCE, NAME, MIMETYPE, CONTENTSIZE, CONTENT, 
            OPTIMISTICLOCKINGVERSION from FILES where KEYID=#value# 
    </statement>

    <statement id="getFilesByName"
        parameterClass="java.lang.String" resultMap="file">
        select KEYID, KEYTOREFERENCE, NAME, MIMETYPE, CONTENTSIZE, CONTENT, 
            OPTIMISTICLOCKINGVERSION from FILES where NAME=#value# 
    </statement>
    
    <statement id="getFilesByReference" 
        parameterClass="int" resultMap="file">
        select KEYID, KEYTOREFERENCE, NAME, MIMETYPE, CONTENTSIZE, CONTENT, 
            OPTIMISTICLOCKINGVERSION from FILES where KEYTOREFERENCE=#value# 
    </statement>

    <statement id="getAllFiles" resultMap="file">
        select KEYID, KEYTOREFERENCE, NAME, MIMETYPE, CONTENTSIZE, CONTENT, 
            OPTIMISTICLOCKINGVERSION from FILES
    </statement>
    
    <delete id="deleteFile">
        delete from FILES where KEYID=#key# AND
        OPTIMISTICLOCKINGVERSION=#optimisticLockingVersion#
    </delete>
    
    <delete id="deleteFileById" parameterClass="int">
        delete from FILES where KEYID=#value#
    </delete>
    
    <!-- 
        FileDescriptorView related invocations
    -->
    <resultMap id="fileDescriptorView"
        class="ch.elca.el4j.apps.refdb.dom.FileDescriptorView">
        <result property="key" column="KEYID"/>
        <result property="keyToReference" column="KEYTOREFERENCE"/>
        <result property="name" column="NAME"/>
        <result property="mimeType" column="MIMETYPE"/>
        <result property="size" column="CONTENTSIZE"/>
        <result property="optimisticLockingVersion" 
            column="OPTIMISTICLOCKINGVERSION"/>
    </resultMap>

    <statement id="getFileDescriptorViewsByReference" 
        parameterClass="int" resultMap="fileDescriptorView">
        select KEYID, KEYTOREFERENCE, NAME, MIMETYPE, CONTENTSIZE, 
            OPTIMISTICLOCKINGVERSION from FILES where KEYTOREFERENCE=#value# 
    </statement>
</sqlMap>
