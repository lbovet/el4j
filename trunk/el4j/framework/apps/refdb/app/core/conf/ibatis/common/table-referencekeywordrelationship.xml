<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com/DTD SQL Map 2.0//EN"
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
	
<sqlMap namespace="refdb-core">
    <!-- Version: $Revision$ -->
    <!-- Source: $Source$ -->
    <!-- Date: $Date$ -->
    <!-- Author: $Author$ -->

    <!-- 
        Reference related invocations
    -->
    <resultMap id="referencekeywordrelationship" 
        class="ch.elca.el4j.apps.refdb.dto.ReferenceKeywordRelationshipDto">
        <result property="keyReference" column="KEYREFERENCE"/>
        <result property="keyKeyword" column="KEYKEYWORD"/>
    </resultMap>
    <statement id="getReferenceKeywordRelationship" 
        resultMap="referencekeywordrelationship">
        select KEYREFERENCE, KEYKEYWORD 
            from REFERENCEKEYWORDRELATIONSHIPS 
                where KEYREFERENCE=#keyReference# and KEYKEYWORD=#keyKeyword#
    </statement>
    <statement id="getAllReferenceKeywordRelationshipsByReference" 
        parameterClass="int" 
        resultMap="referencekeywordrelationship">
        select KEYREFERENCE, KEYKEYWORD 
            from REFERENCEKEYWORDRELATIONSHIPS 
                where KEYREFERENCE=#value#
    </statement>
    <statement id="getAllReferenceKeywordRelationshipsByKeyword" 
        parameterClass="int"
        resultMap="referencekeywordrelationship">
        select KEYREFERENCE, KEYKEYWORD 
            from REFERENCEKEYWORDRELATIONSHIPS 
                where KEYKEYWORD=#value#
    </statement>
    
    <statement id="getKeywordsByReferenceKey" 
        parameterClass="int" resultMap="keyword-core.keyword">
        select KEYID, NAME, DESCRIPTION, OPTIMISTICLOCKINGVERSION
            from KEYWORDS, REFERENCEKEYWORDRELATIONSHIPS
                where KEYID=KEYKEYWORD and KEYREFERENCE=#value# 
    </statement>
    
    <update id="addReferenceKeywordRelationship">        
        insert into REFERENCEKEYWORDRELATIONSHIPS (KEYREFERENCE, KEYKEYWORD)
            values (#keyReference#, #keyKeyword#)
    </update>
    <delete id="deleteAllReferenceKeywordRelationshipsByReference"
        parameterClass="int">
        delete from REFERENCEKEYWORDRELATIONSHIPS where KEYREFERENCE=#value#
    </delete>
    <delete id="deleteAllReferenceKeywordRelationshipsByKeyword"
        parameterClass="int">
        delete from REFERENCEKEYWORDRELATIONSHIPS where KEYKEYWORD=#value#
    </delete>
    <delete id="deleteReferenceKeywordRelationship">
        delete from REFERENCEKEYWORDRELATIONSHIPS 
            where KEYREFERENCE=#keyReference# and KEYKEYWORD=#keyKeyword#
    </delete>
</sqlMap>
