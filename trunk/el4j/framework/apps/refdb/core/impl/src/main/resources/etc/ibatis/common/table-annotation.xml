<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="refdb-core">
    <!-- Version: $Revision$ -->
    <!-- URL: $URL$ -->
    <!-- Date: $Date$ -->
    <!-- Author: $Author$ -->

    <!-- 
        Annotation related invocations
    -->
    <typeAlias 
        type="com.ibatis.sqlmap.engine.type.ClobTypeHandlerCallback" 
        alias="clobHandler" />
        
    <resultMap id="annotation"
        class="ch.elca.el4j.apps.refdb.dom.Annotation">
        <result property="key" column="KEYID"/>
        <result property="keyToReference" column="KEYTOREFERENCE"/>
        <result property="annotator" column="ANNOTATOR"/>
        <result property="grade" column="GRADE"/>
        <result property="content" column="CONTENT" typeHandler="clobHandler"/>
        <result property="whenInserted" column="WHENINSERTED"/>
        <result property="optimisticLockingVersion" 
            column="OPTIMISTICLOCKINGVERSION"/>
    </resultMap>

    <statement id="getAnnotationByKey" 
        parameterClass="int" resultMap="annotation">
        select KEYID, KEYTOREFERENCE, ANNOTATOR, GRADE, CONTENT, WHENINSERTED,
            OPTIMISTICLOCKINGVERSION from ANNOTATIONS where KEYID=#value#
    </statement>

    <statement id="getAnnotationsByAnnotator" 
        parameterClass="java.lang.String" resultMap="annotation">
        select KEYID, KEYTOREFERENCE, ANNOTATOR, GRADE, CONTENT, WHENINSERTED,
            OPTIMISTICLOCKINGVERSION from ANNOTATIONS 
            where ANNOTATOR=#value#
    </statement>
    
    <statement id="getAnnotationsByReference" 
        parameterClass="int" resultMap="annotation">
        select KEYID, KEYTOREFERENCE, ANNOTATOR, GRADE, CONTENT, WHENINSERTED,
            OPTIMISTICLOCKINGVERSION from ANNOTATIONS 
            where KEYTOREFERENCE=#value#
    </statement>

    <statement id="getAllAnnotations" resultMap="annotation">
        select KEYID, KEYTOREFERENCE, ANNOTATOR, GRADE, CONTENT, WHENINSERTED,
            OPTIMISTICLOCKINGVERSION from ANNOTATIONS
    </statement>

	<delete id="deleteAnnotation">
        delete from ANNOTATIONS where KEYID=#key# AND
        OPTIMISTICLOCKINGVERSION=#optimisticLockingVersion#
    </delete>

    <delete id="deleteAnnotationById" parameterClass="int">
        delete from ANNOTATIONS where KEYID=#value#
    </delete>
</sqlMap>
