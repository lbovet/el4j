---+ Getting started

   Remark: Every directory mentioned in this document is relative to the 
   el4j-<version> parent directory.

---+ Directory structure

   * The directory "external-tools" contains tools like Maven,
     Tomcat, Weblogic, JBoss and so on. At minimum the directory "external-tools" contains a directory "maven" that holds the used version of Maven 2.
     If no other structure is needed, it is recommended to save all external
     tools of a project into this directory.

   * The directory "plugins" contains the EL4J plugins for Maven 2. If your 
     download does not contain it, you can get it from the SourceForge Subversion server (svn co https://svn.sourceforge.net/svnroot/el4j/trunk/el4j/plugins).

   * The directory "framework" contains the EL4J framework. If your 
     download does not contain it, you can get it from SourceForge Subversion
     server (svn co https://svn.sourceforge.net/svnroot/el4j/trunk/el4j/framework).

   * The directory "etc" contains various little files for EL4J, like the
     Checkstyle configuration file, the stylesheet for the Javadoc and
     the Maven 2 setting configuration file.

   * The directory "helloworld" is a small EL4J project template that can be
     used to start a new project. If your download does not contain it, you can get it from SourceForge Subversion server
     (svn co https://svn.sourceforge.net/svnroot/el4j/trunk/el4j/helloworld).

   * There are some other directories. For more information please read the
     readme-file inside each directory.
   
---+ Set up the development environment

   * Set the environment variable JAVA_HOME. This variable must point to
     a Java 5 JDK. Example: C:\jdk1.5.0_09 (Remark: some early tests with JDK 1.6 beta 2 showed some problems.)
     
   * Set the environment variable M2_HOME. This variable must point to
     the "maven" directory inside "external-tools".
     Example: D:\el4j-<version>\external-tools\maven

   * Prepend the binary folders of Maven 2 and the JDK to the environment
     varibale PATH. Examples:
       * Windows: %JAVA_HOME%\bin;%M2_HOME%\bin;...
       * Unix: $JAVA_HOME/bin:$M2_HOME/bin:...

   * Open a command line and test if the configuration above made correctly.
     Enter the following commands:
       * java -version
           * Must print out the version number of a Java 5 JDK or newer.
       * javac -version
           * Must print out the same version number as above.
       * mvn -version
           * Must print out the version "2.1-SNAPSHOT" or newer.

   * Copy the file "etc/m2/settings.xml" to directory "~/.m2".

       * Windows users: A directory starting with a dot can only be created by
         using the command line. Change to your home directory and execute the
         command "mkdir .m2". 
         Remark: under Windows, with the directory ~ we mean the home directory
         (i.e. something like c:/Documents and Settings/<yourLogin>/"). 

   * Edit the file "~/.m2/settings.xml" as follows:

       * By default the local repository is located at "~/.m2/repository/".
         If the path to your local repository contains a blank you have to 
         change this path.

           * Choose a new location for the local repository.
             Example: "D:\m2repository". 

       * Search for the element "el4j.project.home". Change the value of this
         element to the path where your EL4J project is.
         Example: "D:\el4j-<version>"
       
       * You will see that some external-tools are preconfigured. If nothing
         special is needed you can leave them as they are. If other containers
         are needed, configure the cargo-maven2-plugin in your pom.xml
         configuration file. For more information see http://cargo.codehaus.org/

       * If you have a proxy, uncomment the <proxies> tag and adapt the settings
         to your system-specific configuration. Make sure to enter "localhost"
         to <nonProxyHosts>, otherwise some tests may fail!

   * In the zip file you can find a directory "m2repository". If you are offline
     or do not want to download all dependencies from the internet you can use
     the given "m2repository" directory as your initial local Maven 2 repository.

---+ Remarks
   
   * Do not use any special characters or spaces in a path. Otherwise some
     plugins will not work. Remember that the length of a path is limited.
   * Windows users:
       * In configuration files and java code use always slashes instead of
         backslashes to describe a path (the above examples work anyway).

---+ ELCA internal settings

   * Here are the differences if you are connected to the ELCA network:

       * The EL4J team has its own server "leaffy.elca.ch". On this server, we
         provide a Maven 2 repository with artifacts that we cannot publish
         publicly. Here you will not receive the unresolved dependency message
         as described below.

   * Because we have a proxy server (proxy.elca.ch) it is hardly recommended to 
     uncomment the preconfigured proxy inside the "~/.m2/settings.xml" file.
     The settings should look as follows:
     ----8<----
     <proxies>
      <proxy>
        <id>optional</id>
        <active>true</active>
        <protocol>http</protocol>
        <host>proxy.elca.ch</host>
        <port>80</port>
        <nonProxyHosts>*.elca.ch|leaffy|localhost</nonProxyHosts>
      </proxy>
    </proxies>
     ---->8----

---+ Introduction to Maven 2

   Maven 2 is a tool to manage software projects. Maven 2 is able to manage a 
   project's build, reporting and documentation based on a project object 
   model called POM. It ist recommended to skim the following sources to 
   get basic knowledge about Maven 2.

   * Maven 2 project page: http://maven.apache.org
   
   * Our Maven 2 presentation:  
      http://el4j.sourceforge.net/docs/pdf/Maven2Course_v1_2.pdf  
      
   * Free Maven 2 book "Better Builds with Maven":
     http://www.mergere.com/m2book_download.jsp
     
   NOTE: When we talk about Maven we talk about Maven 2 and not Maven 1.

---+ Pitfalls

   If you are not inside the ELCA network you will not have access to the 
   EL4J team server (leaffy.elca.ch) you will take notice that the first
   executed Maven command will fail. The reason for this is, that it is not 
   allowed to distribute the JDBC drivers of Oracle and DB2.
   
   You have to download and install them yourself into your local repository.

   * Download the DB2/Derby JDBC driver (db2jcc.jar and db2jcc_license_c.jar)
     from "http://www.ibm.com/developerworks/db2/downloads/jcc/".
   * Download the Oracle driver (ojdbc14.jar)
     from "http://www.oracle.com/technology/software/tech/java/sqlj_jdbc/".
     Note: You can also use the 10g driver for version 9 database.

   Open a command line and change to the directory where you have saved the 
   downloaded jar files. Execute the following commands:
   
   * mvn install:install-file -DgroupId=com.ibm -DartifactId=db2jcc 
                              -Dversion=20040819 -Dpackaging=jar -Dfile=db2jcc.jar
   * mvn install:install-file -DgroupId=com.ibm -DartifactId=db2jcc_license_c 
                              -Dversion=20040819 -Dpackaging=jar -Dfile=db2jcc_license_c.jar
   * mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14_g 
                              -Dversion=10.2.0.1.0 -Dpackaging=jar -Dfile=ojdbc14_g.jar
   
   
   Notes:
   
      * The used file names of the jar files in the commands above depend on the downloaded version.
      * The used version numbers are the ones used in "module-database". Leave these version numbers as they are also if you have downloaded a newer jdbc driver!
     
---+ Maven goals to get started

   Try to execute the given commands at different locations, but try them
   first in the directory where your EL4J is saved (Example: D:\el4j-<version>).
   Remark: We expect that a database is running and by default we use the derby database (compatible with db2), so please launch the database before launching the tests via maven.
   
   * mvn install
      * Compiles, tests, packages and installs the current artifact an all its
        modules (child artifacts). If an artifact is configured for functional
        tests, the needed container will be started and stopped automatically.
        Eclipse project files will be generated automatically for non-pom artifacts.
        
   * mvn install -Pmanual,tomcat5x,db2
      * Will execute the same as above but without testing and without automatic
        container starting and stopping.
        
        The two profiles "tomcat5x" and "db2" must be set regardless of the fact that they are obviously not needed because the environment properties are needed for the resource filtering and these filtered resources will take place in the jar/war/ear files.
        
        FYI: As soon as one profile is set manually, all profile that are activated by default (such as "tomcat5x" and "db2") will be inactivated. Therefore you have to activate the needed profiles yourself (as shown in the command above).

   * mvn clean
      * Deletes the generated directory "target" plus the Eclipse project files 
        for non-pom artifacts.
   
   It is recommended to always execute all the desired phases above in one Maven command. Example: mvn clean install
   
   We typically make the following settings in the environment in order for the maven task to have enough memory: 
    MAVEN_OPTS=-Xmx512m -Xss128k -XX:MaxPermSize=256m
   
---+ Further maven goals

   * mvn -h
       * Lists the help for Maven.

   * mvn -N <goal>
       * Maven will not visiting modules (child artifacts). The given goal will
         be executed only for the current artifact.

   * mvn javadoc:javadoc
       * Generates Javadoc into directory "target/site/apidocs".

   * mvn checkstyle:checkstyle
       * Checks the style of the code by applying the EL4J's Checkstyle rules. 
         The generated report can be found at "target/site/checkstyle.html".

   * mvn site
       * Creates a complete documentation website containing Javadoc, Checkstyle, JUnit and other report pages for the current artifact. JUnit tests will be directly executed for the current artifact. The generated site can be found at "target/site".
   
   * mvn site -Dmaven.test.skip=true
       * Generates the documentation website without running the tests. This is useful after the documentation was updated.
         
   * mvn test
       * Run the JUnit tests.
     
   * mvn package
       * Creates jar/war/ear file (depending on the type of the pom). The generated files can be found in the directory "target". For artifacts of type "jar" a jar file containing the sources will be automatically created. These two jars will be created for the test parts of the current artifact too.

   * mvn cargo:start
       * Starts the configured container. By default this is Tomcat 5.
   
   * mvn cargo:deploy
       * Deploys the configured deployable. If the current artifact is of type war this war will be deployed.
         
   * mvn cargo:undeploy
       * Undeploys the configured deployable. If the current artifact is of type war this war will be undeployed.
         
   * mvn cargo:stop
       * Stops the configured container. By default this is Tomcat 5.

   * mvn install:install-file 
         -DgroupId=<name of repository directory e.g. com.oracle> 
         -DartifactId=<unique id used as reference in the pom.xml e.g. ojdbc14_g> 
         -Dversion=<version e.g. 10.2.0.1> -Dpackaging=jar -Dfile=<path to the jar to import>
	 
         
       * Used to install a jar library in the local Maven repository. For example the Oracle and DB2 JDBC driver has to be installed using this goal, if EL4J is used. This because the licence of the freely available drivers does not allow redistribution.
       Please see above for samples for this.

---+ Maven 2 and Eclipse (recommendations for work with EL4J)

   Eclipse is often used as development environment. Maven is used to manage software project completely. Eclipse should only be used to write code and test small parts of the project. Most other development tasks should be executed wit Maven, especially the unit tests due to the following reasons:
   
   * Eclipse projects do not separate compile and test scope as Maven does. This 
     can be dangerous, for example if the directory test resources contain Spring bean xml files in the “mandatory” directory. This means in EL4J a special place where to place spring bean configuration files.
   * Maven does always have dependent jar artifacts as jar files in the
     classpath. In Eclipse, depending to execution level/directory of the goal “mvn eclipse:eclipse”, some dependencies are in classpath as jar and some directly as directory with its classes. The test classes itself are always in classpath via directory.
   * Eclipse has its own compiler. There are some cases, for example with Java 5 
     syntax, that tests work only if the classes are compiled with the Eclipse compiler. If they are compiled with a Sun’s compiler, the tests fail. At the end tests should work with both compilers (so using the stricter compiler (as with maven) improves compatibility).

---+ Setup an Eclipse workspace

   To use Eclipse for Maven artifacts, the following set up is necessary:
   
   * Start Eclipse with your project's workspace.
     Example: D:\el4j-<version>\workspace
   * Import your Eclipse preferences file for your project if already one
     exists.
   * Close Eclipse.
   * Open a command line in the directory where your workspace directory is.
     Example: D:\el4j-<version>
   * Execute the following command:
     mvn -N eclipse:add-maven-repo
     
     Through this command, the classpath variable M2_REPO will be added to the current Eclipse workspace. Start this Eclipse workspace again and open  
     "Window --> Preferences --> Java --> Build Path --> Classpath Variables"
     and you will find variable M2_REPO.

   The maven-eclipse-plugin is used to generate Eclipse projects for artifact.
   Eclipse projects will be only generated for artifact that are not of type 
   "pom" (e.g. jar, war ...).

   * mvn eclipse:eclipse
       * Based on the pom.xml file, Maven creates the Eclipse projects. After
         the generation you can import the existing Eclipse projects into
         your workspace.
       * This eclipse goal is bound to the phase test-compile, so a "mvn
         install" will create the Eclipse project files too.

   * mvn eclipse:clean
       * Deletes the Eclipse project files.
       * This clean goal is bound on phase clean, so a "mvn clean"
         will delete the Eclipse project files too.
   
   It is recommended to always execute the two goals at the same invocation.
   Example: mvn eclipse:clean eclipse:eclipse
   
   To enable the download of sources of the dependencies you may have to define
   the system property "downloadSources" with value "true".
   Example: mvn eclipse:clean eclipse:eclipse -DdownloadSources=true
   
