<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
	"http://www.springframework.org/dtd/spring-beans.dtd">
<!-- $Id$ -->
<beans>
	<bean id="application"
		class="org.springframework.richclient.application.Application">
		<constructor-arg index="0" ref="applicationDescriptor" />
		<constructor-arg index="1" ref="lifecycleAdvisor" />
	</bean>

	<bean id="lifecycleAdvisor"
		class="ch.elca.el4j.demos.rcp.app.LifecycleAdvisor">
		<property name="windowCommandBarDefinitions"
			value="mandatory/ui/commands-context.xml" />
		<property name="startingPageId" value="addressView" />
		<property name="registerableExceptionHandler"
			ref="exceptionHandler" />
	</bean>

	<bean id="exceptionHandler"
		class="org.springframework.richclient.exceptionhandling.DelegatingExceptionHandler">
		<property name="delegateList">
			<list>
				<bean
					class="org.springframework.richclient.exceptionhandling.DelegatingExceptionHandlerDelegate">
					<property name="throwableClassList">
						<list>
							<value type="java.lang.Class">org.hibernate.HibernateException</value>
							<value type="java.lang.Class">org.hibernate.PropertyValueException</value>
						</list>
					</property>
					<property name="exceptionHandler">
						<bean
							class="org.springframework.richclient.exceptionhandling.MessagesDialogExceptionHandler">
							<property name="logLevel" value="WARN" />
							<property name="shutdownPolicy"
								value="NONE" />
						</bean>
					</property>
				</bean>

				<bean
					class="org.springframework.richclient.exceptionhandling.DelegatingExceptionHandlerDelegate">
					<property name="throwableClass">
						<value type="java.lang.Class">org.hibernate.validator.InvalidStateException</value>
					</property>
					<property name="exceptionHandler">
						<bean
							class="org.springframework.richclient.exceptionhandling.HibernateValidatorDialogExceptionHandler">
							<property name="logLevel" value="INFO" />
							<property name="shutdownPolicy"
								value="NONE" />
						</bean>
					</property>
				</bean>
				<!--
					Warning: When validating non-null columns with Hibernate's DAO based validation,
					Hibernate's can also throws org.hibernate.PropertyValueException which are wrapped by spring
					See http://opensource.atlassian.com/projects/hibernate/browse/ANN-396
				-->
				<!--<bean class="org.springframework.richclient.exceptionhandling.DelegatingExceptionHandlerDelegate">-->
				<!--<property name="throwableClass">-->
				<!--<value type="java.lang.Class">org.springframework.orm.hibernate3.HibernateSystemException</value>-->
				<!--</property>-->
				<!--<property name="exceptionHandler">-->
				<!--<bean class="org.springframework.richclient.exceptionhandling.MessagesDialogExceptionHandler">-->
				<!--<property name="logLevel" value="INFO"/>-->
				<!--<property name="shutdownPolicy" value="NONE"/>-->
				<!--<property name="evaluatedChainedIndex" value="1"/>-->
				<!--</bean>-->
				<!--</property>-->
				<!--</bean>-->
				<bean
					class="org.springframework.richclient.exceptionhandling.DelegatingExceptionHandlerDelegate">
					<property name="throwableClass">
						<value type="java.lang.Class">java.lang.Error</value>
					</property>
					<property name="exceptionHandler">
						<bean
							class="org.springframework.richclient.exceptionhandling.MessagesDialogExceptionHandler">
							<property name="logLevel" value="FATAL" />
							<property name="shutdownPolicy"
								value="OBLIGATE" />
						</bean>
					</property>
				</bean>
				<!-- The order is important: if Throwable would be first then the others would be ignored -->
				<bean
					class="org.springframework.richclient.exceptionhandling.DelegatingExceptionHandlerDelegate">
					<property name="throwableClass">
						<value type="java.lang.Class">java.lang.Throwable</value>
					</property>
					<property name="exceptionHandler">
						<bean
							class="org.springframework.richclient.exceptionhandling.MessagesDialogExceptionHandler">
							<property name="logLevel" value="ERROR" />
							<property name="shutdownPolicy" value="ASK" />
						</bean>
					</property>
				</bean>
			</list>
		</property>
	</bean>

	<bean id="addressView"
		class="org.springframework.richclient.application.support.DefaultViewDescriptor">
		<property name="viewClass">
			<value>ch.elca.el4j.demos.rcp.ui.MasterDetailView</value>
		</property>
		<property name="viewProperties">
			<map>
				<entry key="domainType" value="ch.elca.el4j.apps.refdb.dom.Book" />
			</map>
		</property>
	</bean>

	<bean id="serviceLocator"
		class="org.springframework.richclient.application.ApplicationServicesLocator">
		<property name="applicationServices" ref="applicationServices" />
	</bean>


	<bean id="applicationDescriptor"
		class="org.springframework.richclient.application.support.DefaultApplicationDescriptor">
		<property name="version" value="1.0" />
		<property name="buildId" value="20060408-001" />
	</bean>

	<bean id="applicationObjectConfigurer" depends-on="serviceLocator"
		class="org.springframework.richclient.application.config.DefaultApplicationObjectConfigurer">
	</bean>

	<bean id="lookAndFeelConfigurer"
		class="org.springframework.richclient.application.config.JGoodiesLooksConfigurer">
		<property name="popupDropShadowEnabled" value="false" />
		<property name="theme">
			<bean
				class="com.jgoodies.looks.plastic.theme.ExperienceBlue" />
		</property>
	</bean>

	<bean id="messageSource"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>mandatory.ui.messages</value>
				<value>org.springframework.richclient.application.messages</value>
			</list>
		</property>
	</bean>

	<bean id="imageResourcesFactory"
		class="org.springframework.context.support.ResourceMapFactoryBean">
		<property name="locations">
			<list>
				<value>classpath:org/springframework/richclient/image/images.properties</value>
				<value>classpath:mandatory/ui/images.properties</value>
			</list>
		</property>
		<property name="resourceBasePath" value="etc/images/" />
	</bean>

	<bean id="imageSource"
		class="org.springframework.richclient.image.DefaultImageSource">
		<constructor-arg index="0" ref="imageResourcesFactory" />
		<property name="brokenImageIndicator"
			value="etc/images/error_obj.gif" />
	</bean>

	<bean id="formComponentInterceptorFactory"
		class="org.springframework.richclient.form.builder.support.ChainedInterceptorFactory">
		<property name="interceptorFactories">
			<list>
				<bean
					class="org.springframework.richclient.form.builder.support.ColorValidationInterceptorFactory">
					<property name="errorColor" value="255,245,245" />
				</bean>
				<bean
					class="org.springframework.richclient.form.builder.support.OverlayValidationInterceptorFactory" />
				<bean
					class="org.springframework.richclient.text.TextComponentPopupInterceptorFactory" />
				<bean
					class="org.springframework.richclient.list.ComboBoxAutoCompletionInterceptorFactory" />
			</list>
		</property>
	</bean>

	<bean id="rulesSource"
		class="ch.elca.el4j.demos.rcp.ui.ValidationRulesSource">
		<property name="domainType" value="ch.elca.el4j.apps.refdb.dom.Book">
		</property>
	</bean>

	<!--  
		<bean id="conversionService"
		class="org.springframework.richclient.application.DefaultConversionServiceFactoryBean">
		<property name="formatterFactory">
			<bean
		class="ch.elca.el4j.demos.rcp.helpers.SimpleAppFormatterFactory" />
		</property>
	</bean>
	-->
	<bean id="applicationServices"
		class="org.springframework.richclient.application.support.DefaultApplicationServices"/>

	<bean id="applicationEventMulticaster"
		class="org.springframework.context.event.SimpleApplicationEventMulticaster" />


</beans>
