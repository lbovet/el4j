<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:ui="http://java.sun.com/jsf/facelets"
                 xmlns:h="http://java.sun.com/jsf/html"
                 xmlns:f="http://java.sun.com/jsf/core"
				 xmlns:c="http://java.sun.com/jstl/core"
                 xmlns:s="http://jboss.com/products/seam/taglib"
				 xmlns:el4j="http://www.elca.ch/el4j/taglib">

	<s:decorate id="#{fieldName}Decoration">
		<div class="prop">
			<s:label styleClass="name #{invalid?'errors':''}">
				#{el4j:h10nFieldName(entityShortName, fieldName)}
				<s:span styleClass="required" rendered="#{utils.isRequired(entity,fieldName)}">*</s:span>
			</s:label>
				
			<span class="value #{invalid?'errors':''}">
				<s:validateAll>
					<c:if test="#{relEntities == null}">
						<el4j:set var="relEntities" value="#{utils.getRelatedEntities(entity,fieldName)}"/>
					</c:if>
					
					<c:if test="#{detailPage == null}">
						<el4j:set var="detailPage" value="#{utils.getDefaultRelatedDetailPage(entity,fieldName)}"/>
					</c:if>
					
					<h:selectOneMenu id="#{fieldName}"
								  value="#{entity[fieldName]}"
							   required="#{utils.isRequired(entity,fieldName)}">
						<s:selectItems value="#{relEntities}"
										 var="selEntity"
									   label="#{selEntity.toString()}"
							noSelectionLabel="Select..."/>
						<f:converter converterId="ch.elca.ttrich.EntityConverter"/> 
					</h:selectOneMenu>
					
					<h:outputText value=" "/>
					<s:link view="#{detailPage}" value="Edit" propagation="none" rendered="#{entity[fieldName] != null}">
						<f:param name="entityId" value="#{objectManager.serializeId(entity[fieldName])}"/>
					</s:link>
				</s:validateAll>
			</span>
				
			<s:message styleClass="error errors"/>
		</div>
	</s:decorate>

</ui:composition>