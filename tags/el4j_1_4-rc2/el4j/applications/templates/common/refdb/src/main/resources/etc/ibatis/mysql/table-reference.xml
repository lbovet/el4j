<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="refdb-core">
    <!-- Version: $Revision$ -->
    <!-- URL: $URL$ -->
    <!-- Date: $Date$ -->
    <!-- Author: $Author$ -->

    <!-- 
        Reference related invocations
    -->
    <!-- 
        ATTENTION: Dynamic parts are only used due to badly implemented jdbc 
        driver from ibm, which does not support java.sql.Types.NULL!
    -->
    <insert id="insertReference">
        insert into REFERENCESTABLE (NAME, HASHVALUE, DESCRIPTION, 
            VERSION, DOCUMENTDATE, INCOMPLETE, WHENINSERTED, 
            OPTIMISTICLOCKINGVERSION) 
            values (#name#, #hashValue#, #description#,
                        #version#, #date#,
            #incomplete#, #whenInserted#, 
                #optimisticLockingVersion#)
        <selectKey resultClass="int" keyProperty="key">
            SELECT LAST_INSERT_ID();
        </selectKey>
    </insert>

    <update id="updateReference">
        update REFERENCESTABLE set
                    NAME=#name#,
                    HASHVALUE=#hashValue#,
                    DESCRIPTION=#description#,
                    VERSION=#version#,
                    DOCUMENTDATE=#date#,
            INCOMPLETE=#incomplete#, 
            OPTIMISTICLOCKINGVERSION=OPTIMISTICLOCKINGVERSION+1 
            where KEYID=#key# 
                and OPTIMISTICLOCKINGVERSION=#optimisticLockingVersion#
    </update>
</sqlMap>
