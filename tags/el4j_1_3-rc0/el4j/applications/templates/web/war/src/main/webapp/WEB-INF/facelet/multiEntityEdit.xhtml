<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
				xmlns:c="http://java.sun.com/jstl/core"
				xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
                xmlns:s="http://jboss.com/products/seam/taglib"
				xmlns:el4j="http://www.elca.ch/el4j/taglib">

	<a4j:outputPanel id="#{fieldName}OutputPanel">
	<a4j:region>
		<c:if test="#{relEntities == null}">
			<el4j:set var="relEntities" value="#{utils.getRelatedEntities(entityClassName,fieldName)}"/>
		</c:if>
		
		<c:if test="#{detailPage == null}">
			<el4j:set var="detailPage" value="#{utils.getDefaultRelatedDetailPage(entityClassName,fieldName)}"/>
		</c:if>
		
		<ul>
		<ui:repeat value="#{entity[fieldName].toArray()}" var="ent">
			<li>
				<h:outputText value="#{ent.toString()}"/>
				<h:outputText value=" "/>
				<a4j:commandLink value="Remove"
							  reRender="#{fieldName}OutputPanel"
								action="#{entity[fieldName].remove(ent)}"/>
				<h:outputText value=" "/>
				<h:commandLink value="Edit" action="#{entityManager.edit(ent, detailPage)}"/>
			</li>
		</ui:repeat>
		</ul>
		
		<h:selectOneMenu id="#{fieldName}Add"
					  value="#{temporary[fieldName]}">
			<s:selectItems value="#{relEntities}" var="selEntity"
				label="#{selEntity.toString()}" noSelectionLabel="Select..."/>
			<f:converter converterId="ch.elca.el4j.seam.generic.EntityConverter"/> 
		</h:selectOneMenu>
		
		<a4j:commandButton value="Add"
						reRender="#{fieldName}OutputPanel"
						  action="#{entity[fieldName].add(temporary[fieldName])}"/>
	</a4j:region>
	</a4j:outputPanel>
	
</ui:composition>