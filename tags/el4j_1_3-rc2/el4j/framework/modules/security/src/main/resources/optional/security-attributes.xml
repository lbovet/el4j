<?xml version="1.0" encoding="UTF-8"?>
<!--
    Spring bean configuration file to add security to methods where acegi 
    security commons attributes are defined.
-->
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

    <!-- $Revision$ -->
    <!-- $URL$ -->
    <!-- $Date$ -->
    <!-- $Author$ -->
    
    <!--
        This bean is a postprocessor that will automatically apply relevant advisors
        to any bean in child factories.
    -->
    <bean id="autoproxy" 
        class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator">
    </bean>
    
    <!--
        AOP advisor that will automatically wire the MethodSecurityInterceptor (above)
        into BankServiceImpl (above). The configuration attributes used are obtained
        from the securityInterceptor.objectDefinitionSouce, which in the
        above configuration is a Commons Attributes-based source.
    -->
    <bean id="methodSecurityAdvisor" 
        class="org.acegisecurity.intercept.method.aopalliance.MethodDefinitionSourceAdvisor">
        <constructor-arg>
            <ref local="securityInterceptor"/>
        </constructor-arg>
    </bean>
    
        <!-- We don't validate config attributes, as it's unsupported by MethodDefinitionAttributes -->
    <bean id="securityInterceptor" 
        class="org.acegisecurity.intercept.method.aopalliance.MethodSecurityInterceptor">
        <property name="validateConfigAttributes">
            <value>false</value>
        </property>
        <property name="authenticationManager">
            <ref bean="authenticationManager"/>
        </property>
        <property name="accessDecisionManager">
            <ref bean="accessDecisionManager"/>
        </property>
        <property name="runAsManager">
            <ref bean="runAsManager"/>
        </property>
        <property name="objectDefinitionSource">
            <ref local="objectDefinitionSource"/>
        </property>
    </bean>
    
    <bean id="objectDefinitionSource" 
        class="org.acegisecurity.intercept.method.MethodDefinitionAttributes">
        <property name="attributes">
            <ref local="attributes"/>
        </property>
    </bean>
    
    <bean id="attributes" 
        class="org.acegisecurity.annotation.SecurityAnnotationAttributes"/>
        
</beans>